æ²¡æœ‰åœ¨2017-12-13-ss-directory-tree.mdæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼
æ²¡æœ‰åœ¨2017-12-14-ss-work-method.mdæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼
æ²¡æœ‰åœ¨2017-12-16-boot-local-py.mdæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼
æ²¡æœ‰åœ¨2017-12-23-eventloop.mdæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼
æ²¡æœ‰åœ¨2017-12-23-understanding-kevent-control-method.mdæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼
æ²¡æœ‰åœ¨2017-12-26-tcprelay.mdæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼
---
title: 'If you want to keep a secret, you must also hide it from yourself. ğŸ‘½'
background: backgrounds/home.jpg
---

å¦‚æœä½ æƒ³ä¿ä½ä¸€ä¸ªç§˜å¯†, ä½ å¿…é¡»ä»ä½ å¼€å§‹å°±ä¸çŸ¥é“å®ƒ.
========================================

cryptor æ¨¡å—æˆå°±äº†æˆ‘ä»¬çš„\*\*\*, éšè—è‡ªå·±. æ”¯æŒå¸¸è§çš„åŠ å¯†ç®—æ³•ä»¥åŠå·²ç»ä¸å¤ªå®‰å…¨çš„åŠ å¯†ç®—æ³•ä¹Ÿè¢«æ”¯æŒ.

TL;DR
------

<!-- add TL;DR -->

å¯¼å…¥(import)
----

```python
from __future__ import absolute_import, division, print_function, \
  with_statement

import os
import sys
import hashlib
import logging

from shadowsocks import common
from shadowsocks.crypto import rc4_md5, openssl, mbedtls, sodium, table
```

å¼•å…¥ `os`, `sys`, `hashlib`, `logging` æ¨¡å—

* [os][os-module]
* [sys][sys-module]
* [hashlib][hashlib-module]
* [logging][logging-module]

å¸¸é‡(constants)
--------------

```python
CIPHER_ENC_ENCRYPTION = 1
CIPHER_ENC_DECRYPTION = 0
```

åŠ å¯†æ ‡å¿—ä½ä¸º `1`, è§£å¯†æ ‡å¿—ä½ä¸º `0`, ä¸æ˜¯ SS è§„å®šçš„, Openssl è§„å®šçš„:

>EVP\_CipherInit\_ex(), EVP\_CipherUpdate() and EVP\_CipherFinal\_ex() are functions that can be used for decryption or encryption. The operation performed depends on the value of the enc parameter. It should be set to 1 for encryption, 0 for decryption and -1 to leave the value unchanged (the actual value of 'enc' being supplied in a previous call).

>å¼•ç”¨è‡ª: <https://www.openssl.org/docs/man1.1.0/crypto/EVP_CIPHER_CTX_new.html>

```python
METHOD_INFO_KEY_LEN = 0 # _method_info é‡Œé¢çš„ç´¢å¼•å€¼ ä»£è¡¨çš„æ˜¯ KEY çš„é•¿åº¦
METHOD_INFO_IV_LEN = 1  # _method_info é‡Œé¢çš„ç´¢å¼•å€¼ ä»£è¡¨çš„æ˜¯åˆå§‹åŒ–å‘é‡çš„é•¿åº¦
METHOD_INFO_CRYPTO = 2  # _method_info é‡Œé¢çš„ç´¢å¼•å€¼ ä»£è¡¨çš„æ˜¯åŠ å¯†ç®—æ³•çš„å®ä¾‹ ç”¨æ¥åŠ å¯†
```

*è§æ³¨é‡Š*

è¿™ä¸‰ä¸ªå˜é‡å’ŒåŠ å¯†(crypto)æ¨¡å—æš´éœ²å‡ºæ¥çš„ç›¸å¯¹åº”çš„å¯¹è±¡çš„ç´¢å¼•å€¼, æ¥ä¸‹æ¥å–æ•°æ®ç”¨è¿™é‡Œçš„å˜é‡å–

<!-- TODO: -->

<!-- Generate by template.js -->
<div className="program-flow-walkthrough" data-panel-title="ç¨‹åºæµæ§åˆ¶é¢æ¿" id="crypto-class">
			<div className="program-flow-walkthrough-codesource">
				<div className="line-highlight"></div>
				<div className="codehilite">
					{% highlight python %}
class Cryptor(object):
    def __init__(self, password, method, crypto_path=None):
        """
        Crypto wrapper
        :param password: str cipher password
        :param method: str cipher
        :param crypto_path: dict or none
            {'openssl': path, 'sodium': path, 'mbedtls': path}
        """
        self.password = password
        self.key = None
        self.method = method
        self.iv_sent = False
        self.cipher_iv = b''
        self.decipher = None
        self.decipher_iv = None
        self.crypto_path = crypto_path
        method = method.lower()
        self._method_info = Cryptor.get_method_info(method)
        if self._method_info:
            self.cipher = self.get_cipher(
                password, method, CIPHER_ENC_ENCRYPTION,
                random_string(self._method_info[METHOD_INFO_IV_LEN])
            )
        else:
            logging.error('method %s not supported' % method)
            sys.exit(1)
					{% endhighlight %}
				</div>
			</div>
			<table>
				<tr class="task-queue">
								<th>Task</th>
								<td><div class="event-loop-items">
									<div class="event-loop-rail">
										<div class="event-loop-item">Run script</div>,<div class="event-loop-item">setTimeout callback</div>
									</div>
								</div></td>
							</tr>
<tr class="microtask-queue">
								<th>Microtasks</th>
								<td><div class="event-loop-items">
									<div class="event-loop-rail">
										<div class="event-loop-item">Run script</div>,<div class="event-loop-item">setTimeout callback</div>
									</div>
								</div></td>
							</tr>
<tr class="js-stack">
								<th>JS Stack</th>
								<td><div class="event-loop-items">
									<div class="event-loop-rail">
										<div class="event-loop-item">Run script</div>,<div class="event-loop-item">setTimeout callback</div>
									</div>
								</div></td>
							</tr>
<tr class="event-loop-log">
								<th>Log</th>
								<td><div class="event-loop-items">
									<div class="event-loop-rail">
										<div class="event-loop-item">Run, script</div>,<div class="event-loop-item">setTimeout callback</div>
									</div>
								</div></td>
							</tr>
			</table>
			<div class="event-loop-controls">
					    <svg viewBox="0 0 5 2">
					      <path d="M2,0 L2,2 L0,1 z"></path>
					      <path d="M3,0 L5,1 L3,2 z"></path>
					      <path class="prev-btn" d="M0,0 H2.5V2H0z"></path>
					      <path class="next-btn" d="M2.5,0 H5V2H2.5z"></path>
					    </svg>
					</div>
			<div class="event-loop-commentary">
					    <div class="event-loop-commentary-item"></div>
					</div>
		</div>
<!-- Generate by template.js END -->

{% include eventloopanimation.html %}
<script>
/* Transformed by babel-transform.js */
'use strict';

;(function () {
  var test = document.getElementById('test');
  var testEventLoop = new EventLoopAnimation(test);
  testEventLoop.state().moveToLine(3).showCodeBar().state().moveToLine(4).state().moveToLine(5).state().moveToLine(6).state().moveToLine(7).state().moveToLine(8);
})();
/* Transformed by babel-transform.js END */
</script>


[os-module]: <https://docs.python.org/2.7/library/os.html>
[sys-module]: <https://docs.python.org/2.7/library/sys.html>
[hashlib-module]: <https://docs.python.org/2.7/library/hashlib.html>
[logging-module]: <https://docs.python.org/2.7/library/logging.html>
